<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Amplify 2026 Partnership â€” Fora</title>
  <script src="partners-public.js?v=202602191700"></script>
  <style>
    @font-face {
      font-family: 'ChiswickSansText';
      src: url('fonts/ChiswickSansText-Regular.otf') format('opentype');
      font-weight: 400; font-display: swap;
    }
    @font-face {
      font-family: 'ChiswickSansText';
      src: url('fonts/ChiswickSansText-Semibold.otf') format('opentype');
      font-weight: 600; font-display: swap;
    }
    @font-face {
      font-family: 'Blanco';
      src: url('fonts/Blanco-Regular.otf') format('opentype');
      font-weight: 400; font-display: swap;
    }
    @font-face {
      font-family: 'Blanco';
      src: url('fonts/Blanco-Bold.otf') format('opentype');
      font-weight: 700; font-display: swap;
    }

    :root {
      --navy:    #131313;
      --olive:   #77742a;
      --indigo:  #333880;
      --sangria: #870d13;
      --stone:   #827363;
      --shell:   #e5dbd0;
      --sand:    #fefaf5;
      --dsand:   #f3ebe2;
      --border:  #e5dbd0;
      --text:    #131313;
      --tlight:  #827363;
      --radius:  14px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Blanco', -apple-system, sans-serif;
      background: var(--sand);
      color: var(--text);
      font-size: 15px;
      line-height: 1.6;
    }

    /* â”€â”€ HEADER â”€â”€ */
    .header {
      background: var(--navy);
      padding: 28px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .fora-mark {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 18px;
      font-weight: 400;
      color: rgba(255,255,255,0.55);
      letter-spacing: 0.06em;
    }
    .header-label {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: #e5dbd0;
      letter-spacing: 0.04em;
    }

    /* â”€â”€ HERO â”€â”€ */
    .hero {
      background: var(--navy);
      padding: 0 40px 48px;
      border-bottom: 3px solid var(--olive);
    }
    .hero-eyebrow {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--olive);
      margin-bottom: 10px;
    }
    .hero-name {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 38px;
      font-weight: 600;
      color: #fff;
      line-height: 1.15;
      margin-bottom: 10px;
    }
    .hero-meta {
      font-size: 14px;
      color: rgba(255,255,255,0.5);
    }
    .hero-meta span { margin-right: 16px; }

    /* â”€â”€ LAYOUT â”€â”€ */
    .content {
      max-width: 780px;
      margin: 0 auto;
      padding: 48px 24px 80px;
    }

    /* â”€â”€ SECTION â”€â”€ */
    .section {
      margin-bottom: 40px;
    }
    .section-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--tlight);
      margin-bottom: 16px;
    }

    /* â”€â”€ PACKAGE PILLS â”€â”€ */
    .pkg-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .pkg-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 18px;
      flex: 1 1 160px;
    }
    .pkg-pill-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      flex-shrink: 0;
    }
    .pkg-pill-text { line-height: 1.3; }
    .pkg-pill-name { font-size: 13px; font-weight: 600; color: var(--text); }
    .pkg-pill-qty  { font-size: 12px; color: var(--tlight); }

    /* â”€â”€ ASSET COLUMN â”€â”€ */
    .asset-pill {
      display: inline-flex; align-items: center; gap: 8px;
      background: var(--dsand); border: 1px solid rgba(119,116,42,0.35);
      border-radius: 8px; padding: 6px 12px 6px 6px;
      text-decoration: none; color: var(--olive); font-size: 12px; font-weight: 600;
      transition: border-color 0.15s, background 0.15s;
    }
    .asset-pill:hover { border-color: var(--olive); background: rgba(119,116,42,0.1); }
    .asset-thumb {
      width: 52px; height: 40px; object-fit: cover;
      border-radius: 5px; background: var(--shell); flex-shrink: 0; border: 1px solid var(--border);
    }
    .asset-col { vertical-align: middle; min-width: 180px; }

    /* â”€â”€ DELIVERABLES TABLE â”€â”€ */
    .deliv-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    .deliv-table thead tr {
      background: var(--dsand);
    }
    .deliv-table th {
      padding: 11px 18px;
      text-align: left;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--tlight);
    }
    .deliv-table td {
      padding: 14px 18px;
      font-size: 14px;
      border-top: 1px solid var(--border);
      vertical-align: middle;
    }
    .deliv-table tr:last-child td { border-bottom: none; }

    /* â”€â”€ STATUS BADGES â”€â”€ */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 11px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    .badge-done    { background: #e8f5ee; color: #1a6b3a; }
    .badge-upcoming{ background: #ecedf8; color: var(--indigo); }
    .badge-tbd     { background: var(--dsand); color: var(--tlight); }
    .badge-included{ background: #e8f5ee; color: #1a6b3a; }

    /* â”€â”€ INVOICE CARD â”€â”€ */
    .invoice-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px 28px;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .invoice-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    .invoice-title {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 3px;
    }
    .invoice-sub { font-size: 13px; color: var(--tlight); }

    /* â”€â”€ CONTENT CARD â”€â”€ */
    .content-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px 28px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .content-card-icon {
      width: 48px;
      height: 48px;
      background: var(--dsand);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }
    .content-card-body { flex: 1; min-width: 180px; }
    .content-card-title { font-family: 'ChiswickSansText', sans-serif; font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .content-card-sub { font-size: 13px; color: var(--tlight); }
    .content-card-link {
      display: inline-block;
      background: var(--olive);
      color: #fff;
      text-decoration: none;
      padding: 10px 22px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .content-card-link:hover { background: #5e5c21; }

    /* â”€â”€ CONTACT CARD â”€â”€ */
    .contact-card {
      background: var(--dsand);
      border-radius: var(--radius);
      padding: 28px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
    }
    .contact-text h3 {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .contact-text p { font-size: 13px; color: var(--tlight); }
    .contact-link {
      display: inline-block;
      background: var(--navy);
      color: #fff;
      text-decoration: none;
      padding: 10px 22px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
    }
    .contact-link:hover { background: #2a2a2a; }

    /* â”€â”€ ERROR STATE â”€â”€ */
    .error-wrap {
      max-width: 480px;
      margin: 80px auto;
      text-align: center;
      padding: 0 24px;
    }
    .error-wrap h2 {
      font-family: 'ChiswickSansText', sans-serif;
      font-size: 24px;
      margin-bottom: 12px;
    }
    .error-wrap p { color: var(--tlight); margin-bottom: 24px; }

    /* â”€â”€ FOOTER â”€â”€ */
    .footer {
      text-align: center;
      padding: 32px 24px;
      font-size: 12px;
      color: var(--tlight);
      border-top: 1px solid var(--border);
    }

    @media (max-width: 600px) {
      .header { padding: 20px 20px; }
      .hero { padding: 0 20px 36px; }
      .hero-name { font-size: 28px; }
      .content { padding: 32px 16px 60px; }
      .invoice-card { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>

<div class="header">
  <div class="fora-mark">Fora</div>
  <div class="header-label">Amplify 2026</div>
</div>

<div id="app">
  <!-- Filled by JS -->
</div>

<div class="footer">
  <p>Fora Travel Â· <a href="mailto:partners@foratravel.com" style="color:var(--tlight);">partners@foratravel.com</a> Â· Updated <span id="footerDate"></span></p>
</div>

<script>
  // â”€â”€ Package definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const PACKAGE_DELIVERABLES = {
    'Tier 1': [
      { name: 'Collection',  label: 'Collection Inclusion', icon: 'ðŸ—‚', count: 1 },
      { name: 'Newsletter',  label: 'Newsletter Feature',   icon: 'âœ‰ï¸', count: 1 },
      { name: 'Forum',       label: 'Forum Feature',        icon: 'ðŸ’¬', count: 1 },
    ],
    'Tier 2': [
      { name: 'Collection',    label: 'Collection Inclusion', icon: 'ðŸ—‚', count: 2 },
      { name: 'Newsletter',    label: 'Newsletter Feature',   icon: 'âœ‰ï¸', count: 1 },
      { name: 'Forum',         label: 'Forum Feature',        icon: 'ðŸ’¬', count: 2 },
      { name: 'Advisor Assets',label: 'Advisor Assets',       icon: 'ðŸ“¦', count: 1 },
    ],
    'Brand Spotlight': [
      { name: 'Collection',    label: 'Collection Feature',        icon: 'ðŸ—‚', count: 1 },
      { name: 'Webinar',       label: 'Webinar',                   icon: 'ðŸŽ™', count: 1 },
      { name: 'Advisor Assets',label: 'Advisor Assets',            icon: 'ðŸ“¦', count: 1 },
      { name: 'Forum',         label: 'Live Forum Pre-Sale Access', icon: 'â­', count: 1, alwaysYes: true },
    ],
    'New Opening': [
      { name: 'Collection',  label: 'Collection Feature',  icon: 'ðŸ—‚', count: 1 },
      { name: 'Social Media',label: 'Social Media Feature', icon: 'ðŸ“±', count: 1 },
      { name: 'Forum',       label: 'Forum Post',           icon: 'ðŸ’¬', count: 1 },
    ],
    'New Opening + Advisor Assets': [
      { name: 'Collection',     label: 'Collection Feature',   icon: 'ðŸ—‚', count: 1 },
      { name: 'Social Media',   label: 'Social Media Feature', icon: 'ðŸ“±', count: 1 },
      { name: 'Forum',          label: 'Forum Post',           icon: 'ðŸ’¬', count: 1 },
      { name: 'Advisor Assets', label: 'Advisor Assets',       icon: 'ðŸ“¦', count: 1 },
    ],
    'Brand Spotlight + Additional Webinar': [
      { name: 'Collection',    label: 'Collection Feature',        icon: 'ðŸ—‚', count: 1 },
      { name: 'Webinar',       label: 'Webinar',                   icon: 'ðŸŽ™', count: 2 },
      { name: 'Advisor Assets',label: 'Advisor Assets',            icon: 'ðŸ“¦', count: 1 },
      { name: 'Forum',         label: 'Live Forum Pre-Sale Access', icon: 'â­', count: 1, alwaysYes: true },
    ],
    'Bespoke Kempinski': [
      { name: 'Collection',    label: 'Collection Inclusions',        icon: 'ðŸ—‚', count: 6 },
      { name: 'Newsletter',    label: 'Advisor Newsletter Features',  icon: 'âœ‰ï¸', count: 4 },
      { name: 'Webinar',       label: 'Webinars',                     icon: 'ðŸŽ™', count: 2, noAsset: true },
      { name: 'Advisor Assets',label: 'Advisor Assets',               icon: 'ðŸ“¦', count: 4 },
      { name: 'Forum',         label: 'Forum Posts',                  icon: 'ðŸ’¬', count: 6 },
    ],
    'Newsletter + Forum Feature': [
      { name: 'Newsletter', label: 'Newsletter Feature', icon: 'âœ‰ï¸', count: 1 },
      { name: 'Forum',      label: 'Forum Feature',      icon: 'ðŸ’¬', count: 1 },
    ],
  };

  const DELIV_ICONS = {
    'Collection': 'ðŸ—‚', 'Newsletter': 'âœ‰ï¸', 'Forum': 'ðŸ’¬',
    'Advisor Assets': 'ðŸ“¦', 'Webinar': 'ðŸŽ™', 'Social Media': 'ðŸ“±',
    'Journal Article': 'ðŸ“', 'Webinar Recording': 'ðŸŽ™',
  };

  const PKG_COLORS = {
    'Tier 1':          { bg: '#f0efe6', color: '#77742a' },
    'Tier 2':          { bg: '#ecedf8', color: '#333880' },
    'Brand Spotlight':                    { bg: '#1e1e1e', color: '#e5dbd0' },
    'Brand Spotlight + Additional Webinar':{ bg: '#1e1e1e', color: '#e5dbd0' },
    'New Opening':                        { bg: '#f5ece8', color: '#7a3520' },
    'New Opening + Advisor Assets':       { bg: '#f5ece8', color: '#7a3520' },
    'Bespoke Kempinski':                  { bg: '#131313', color: '#e5dbd0' },
    'Newsletter + Forum Feature':         { bg: '#ecedf8', color: '#333880' },
    'Marketing Complete':                 { bg: '#e8f5ee', color: '#1a6b3a' },
  };

  // â”€â”€ Smart package deliverable resolver â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const _KNOWN_DELIVS = {
    'advisor assets': { name: 'Advisor Assets', label: 'Advisor Assets',       icon: 'ðŸ“¦', count: 1 },
    'newsletter':     { name: 'Newsletter',     label: 'Newsletter Feature',   icon: 'âœ‰ï¸', count: 1 },
    'forum':          { name: 'Forum',          label: 'Forum Feature',        icon: 'ðŸ’¬', count: 1 },
    'collection':     { name: 'Collection',     label: 'Collection Feature',   icon: 'ðŸ—‚', count: 1 },
    'social media':   { name: 'Social Media',   label: 'Social Media Feature', icon: 'ðŸ“±', count: 1 },
    'journal article':{ name: 'Journal Article',label: 'Journal Article',      icon: 'ðŸ“', count: 1 },
    'webinar':        { name: 'Webinar',        label: 'Webinar',              icon: 'ðŸŽ™', count: 1, noAsset: true },
  };
  function _resolvePackageDelivs(packageName) {
    if (!packageName) return null;
    if (PACKAGE_DELIVERABLES[packageName]) return PACKAGE_DELIVERABLES[packageName];
    const parts = packageName.split('+').map(s => s.trim());
    const base = PACKAGE_DELIVERABLES[parts[0]];
    if (!base) return null;
    const baseNames = new Set(base.map(d => d.name));
    const extras = [];
    for (const part of parts.slice(1)) {
      const lower = part.toLowerCase();
      for (const [keyword, def] of Object.entries(_KNOWN_DELIVS)) {
        if (lower.includes(keyword) && !baseNames.has(def.name)) {
          extras.push({ ...def });
          baseNames.add(def.name);
          break;
        }
      }
    }
    return extras.length > 0 ? [...base, ...extras] : base;
  }

  // â”€â”€ Status helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function delivStatus(timing) {
    if (!timing || !timing.trim()) return 'none';
    const t = timing.toLowerCase();
    if (t.includes('completed')) return 'completed';
    if (t.includes('planned'))   return 'upcoming';
    // DATE-type fields (e.g. Webinar) come as "Month YYYY"
    const now = new Date();
    const months = { january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11 };
    for (const [name, idx] of Object.entries(months)) {
      if (t.includes(name)) {
        const yr = t.match(/\d{4}/);
        const d = new Date(yr ? +yr[0] : now.getFullYear(), idx, 1);
        return d.getFullYear() * 12 + d.getMonth() < now.getFullYear() * 12 + now.getMonth()
          ? 'completed' : 'upcoming';
      }
    }
    return 'upcoming';
  }

  function scheduledMonth(timing) {
    if (!timing || !timing.trim()) return null;
    const dash = timing.indexOf(' - ');
    return dash > 0 ? timing.substring(0, dash).trim() : timing;
  }

  function statusBadge(timing, alwaysYes) {
    if (alwaysYes) return '<span class="badge badge-included">âœ“ Included</span>';
    const st = delivStatus(timing);
    const mo = scheduledMonth(timing);
    if (st === 'completed') return `<span class="badge badge-done">âœ“ Completed${mo ? ' â€” ' + mo : ''}</span>`;
    if (st === 'upcoming')  return `<span class="badge badge-upcoming">Scheduled</span>`;
    return '<span class="badge badge-tbd">To be confirmed</span>';
  }

  // â”€â”€ Invoice status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const INVOICE_STYLE = {
    'Paid':                              { icon: 'âœ“', bg: '#e8f5ee', color: '#1a6b3a', sub: 'Thank you â€” your payment has been received.' },
    'Invoice sent â€” payment pending':    { icon: 'â³', bg: '#fdf6e3', color: '#7a5c00', sub: 'Your invoice has been sent. Please arrange payment at your earliest convenience.' },
    'Invoice coming soon':               { icon: 'ðŸ“„', bg: '#f3ebe2', color: '#827363', sub: 'We\'ll be in touch with your invoice shortly.' },
    'Awaiting your billing information': { icon: 'ðŸ“‹', bg: '#fdf6e3', color: '#7a5c00', sub: 'Please send your billing details to partners@foratravel.com so we can issue your invoice.' },
    'In-kind partnership':               { icon: 'ðŸ¤', bg: '#ecedf8', color: '#333880', sub: 'This partnership is recorded as in-kind.' },
    'On hold â€” please contact us':       { icon: 'âš ', bg: '#fdf0f0', color: '#870d13', sub: 'Please reach out to partners@foratravel.com.' },
  };

  // â”€â”€ Main render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const app = document.getElementById('app');

  if (typeof PARTNER_PUBLIC_DATA === 'undefined') {
    renderError('Data unavailable', 'Partner data could not be loaded. Please try again or contact partners@foratravel.com.');
  } else {
    const params  = new URLSearchParams(window.location.search);
    const key     = params.get('key');
    const partner = key ? PARTNER_PUBLIC_DATA[key] : null;

    if (!partner) {
      renderError('Page not found', 'This link may be incorrect or expired. Please contact your Fora representative for a new link.');
    } else {
      // Fetch live assets directly from partner-resources.json so approved
      // assets appear immediately without waiting for the daily update.py run.
      fetch('partner-resources.json?' + Date.now(), { cache: 'no-cache' })
        .then(r => r.json())
        .then(json => {
          const liveAssets = (json.assets || []).filter(a =>
            a.status === 'live' && (a.partnerKeys || []).includes(key)
          );
          const resources = {};
          liveAssets.forEach(a => {
            if (!resources[a.deliverable]) resources[a.deliverable] = [];
            resources[a.deliverable].push({ label: a.label, path: a.path, note: a.note || '' });
          });
          partner.resources = resources;
        })
        .catch(() => { /* fall back to resources baked into partners-public.js */ })
        .finally(() => {
          renderPartner(partner);
          document.getElementById('footerDate').textContent = partner.lastUpdated || '';
        });
    }
  }

  function renderError(title, msg) {
    app.innerHTML = `
      <div class="error-wrap">
        <h2>${title}</h2>
        <p>${msg}</p>
        <a href="mailto:partners@foratravel.com" style="color:var(--olive);font-weight:600;">partners@foratravel.com</a>
      </div>`;
  }

  function renderPartner(p) {
    const pkgColor  = PKG_COLORS[p.package] || PKG_COLORS[p.package.split('+')[0].trim()] || { bg: '#f3ebe2', color: '#827363' };
    // pillDefs: standard package template for the "Your Package" pills at top
    const pillDefs = _resolvePackageDelivs(p.package) || [];
    // delivDefs: use Streak deliverables as source of truth for the table, enriched with template labels/icons
    const templateMap = {};
    pillDefs.forEach(d => templateMap[d.name] = d);
    const streakDelivs = p.deliverables || [];
    const delivNames = new Set(streakDelivs.map(d => d.name));
    const delivDefs = [
      // All deliverables actually in Streak (with proper labels from template if available)
      ...streakDelivs.map(d => templateMap[d.name] || { name: d.name, label: d.name, icon: DELIV_ICONS[d.name] || 'ðŸ“‹', count: 1 }),
      // Plus any alwaysYes items from template not in Streak (e.g. Forum Pre-Sale Access)
      ...pillDefs.filter(d => d.alwaysYes && !delivNames.has(d.name)),
    ];

    // â”€â”€ Hero â”€â”€
    const heroHtml = `
      <div class="hero">
        <div class="hero-eyebrow">Amplify 2026 Partnership &nbsp;Â·&nbsp; <span style="display:inline-block;background:${pkgColor.bg};color:${pkgColor.color};padding:2px 10px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:0.06em;vertical-align:middle;">${p.package}</span></div>
        <div class="hero-name">${p.name}</div>
      </div>`;

    // â”€â”€ Package pills (use standard template, not bespoke Streak data) â”€â”€
    const pillsHtml = pillDefs.map(d => {
      const qty = d.count > 1 ? `<div class="pkg-pill-qty">Ã—${d.count}</div>` : '';
      return `
        <div class="pkg-pill">
          <div class="pkg-pill-icon" style="background:${pkgColor.bg};color:${pkgColor.color};">${d.icon}</div>
          <div class="pkg-pill-text">
            <div class="pkg-pill-name">${d.label}</div>
            ${qty}
          </div>
        </div>`;
    }).join('');

    // â”€â”€ Deliverables table â”€â”€
    const lookup = {};
    (p.deliverables || []).forEach(f => {
      const raw = typeof f === 'object' ? (f.timing || '') : '';
      lookup[f.name] = raw ? raw.split(',').map(s => s.trim()).filter(Boolean) : [];
    });

    let delivRows = '';
    if (delivDefs.length === 0) {
      delivRows = `<tr><td colspan="4" style="color:var(--tlight);text-align:center;padding:20px;">Deliverables will be confirmed by your Fora representative.</td></tr>`;
    } else {
      delivDefs.forEach(d => {
        if (d.alwaysYes) {
          delivRows += `
            <tr>
              <td><strong>${d.label}</strong></td>
              <td style="color:var(--tlight);">â€”</td>
              <td>${statusBadge('', true)}</td>
              <td class="asset-col"></td>
            </tr>`;
          return;
        }
        const timings = lookup[d.name] || [];
        const assets  = (p.resources || {})[d.name] || [];
        const assetPills = assets.map(a => {
          if (a.assetType === 'url' || (!a.path && a.url)) {
            return `<a href="${a.url}" target="_blank" rel="noopener" class="asset-pill"><span style="font-size:18px;flex-shrink:0;line-height:1;">ðŸ”—</span><span>${a.label || d.label}</span></a>`;
          }
          const isPdf = a.path && a.path.toLowerCase().endsWith('.pdf');
          const thumb = isPdf
            ? `<span style="font-size:20px;flex-shrink:0;line-height:1;">ðŸ“„</span>`
            : `<img src="${a.path}" class="asset-thumb" alt="${a.label}" onerror="this.style.display='none'">`;
          return `<a href="${a.path}" target="_blank" rel="noopener" class="asset-pill">${thumb}<span>${a.label || d.label}</span></a>`;
        }).join('<br style="margin:4px 0;display:block;">');

        for (let i = 0; i < d.count; i++) {
          const t      = timings[i] || '';
          const suffix = d.count > 1 ? ` <span style="color:var(--tlight);font-weight:400;font-size:12px;">(${i+1} of ${d.count})</span>` : '';
          const mo     = scheduledMonth(t);
          // Asset cell: show in first row only, spanning all slots
          const assetTd = i === 0
            ? `<td class="asset-col"${d.count > 1 ? ` rowspan="${d.count}"` : ''}>${assetPills}</td>`
            : '';
          delivRows += `
            <tr>
              <td><strong>${d.label}</strong>${suffix}</td>
              <td style="color:var(--tlight);">${mo || 'â€”'}</td>
              <td>${statusBadge(t, false)}</td>
              ${assetTd}
            </tr>`;
        }
      });
    }

    // â”€â”€ Invoice section â”€â”€
    const invStyle = INVOICE_STYLE[p.invoiceStatus] || { icon: 'ðŸ“„', bg: '#f3ebe2', color: '#827363', sub: 'For invoice enquiries, please contact partners@foratravel.com.' };
    const invoiceHtml = `
      <div class="invoice-card">
        <div class="invoice-icon" style="background:${invStyle.bg};color:${invStyle.color};">${invStyle.icon}</div>
        <div>
          <div class="invoice-title" style="color:${invStyle.color};">${p.invoiceStatus || 'Invoice status unavailable'}</div>
          <div class="invoice-sub">${invStyle.sub}</div>
        </div>
      </div>`;

    // â”€â”€ Quarter info â”€â”€
    const quarterHtml = (p.quarters && p.quarters.length)
      ? `<p style="margin-top:12px;font-size:13px;color:var(--tlight);">Your deliverables are scheduled for <strong style="color:var(--text);">${p.quarters.join(' and ')}</strong>.</p>`
      : '';

    app.innerHTML = `
      ${heroHtml}
      <div class="content">
        <div class="section">
          <div class="section-label">Your Package â€” ${p.package}</div>
          <div class="pkg-pills">${pillsHtml}</div>
        </div>

        <div class="section">
          <div class="section-label">Your Deliverables</div>
          <table class="deliv-table">
            <thead>
              <tr>
                <th>Deliverable</th>
                <th>Scheduled</th>
                <th>Status</th>
                <th>Published Content</th>
              </tr>
            </thead>
            <tbody>${delivRows}</tbody>
          </table>
          ${quarterHtml}
        </div>

        <div class="section">
          <div class="section-label">Invoice</div>
          ${invoiceHtml}
        </div>

        <div class="contact-card">
          <div class="contact-text">
            <h3>Questions about your partnership or keen to hear about more opportunities?</h3>
            <p>Reach out to your Amplify contact, or email <strong>partners@foratravel.com</strong></p>
          </div>
        </div>

        <div class="contact-card" style="margin-top:16px;">
          <div class="contact-text">
            <h3>Submit deals for future features</h3>
            <p>Share upcoming promotions and offers to be considered for Fora advisor content.</p>
          </div>
          <a href="https://travelpartners.foratravel.com/submit-deals" target="_blank" rel="noopener" class="contact-link">Submit deals â†’</a>
        </div>
      </div>`;
  }
</script>
</body>
</html>
