<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amplify 2026 ‚Äî Partner Dashboard</title>
  <script src="data.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* ‚îÄ‚îÄ Fora brand fonts ‚îÄ‚îÄ */
    @font-face {
      font-family: 'ChiswickSansText';
      src: url('fonts/ChiswickSansText-Regular.otf') format('opentype');
      font-weight: 400; font-display: swap;
    }
    @font-face {
      font-family: 'ChiswickSansText';
      src: url('fonts/ChiswickSansText-Semibold.otf') format('opentype');
      font-weight: 600; font-display: swap;
    }
    @font-face {
      font-family: 'Blanco';
      src: url('fonts/Blanco-Regular.otf') format('opentype');
      font-weight: 400; font-display: swap;
    }
    @font-face {
      font-family: 'Blanco';
      src: url('fonts/Blanco-Bold.otf') format('opentype');
      font-weight: 700; font-display: swap;
    }
    @font-face {
      font-family: 'Blanco';
      src: url('fonts/Blanco-Italic.otf') format('opentype');
      font-weight: 400; font-style: italic; font-display: swap;
    }

    :root {
      /* Fora Primary Palette */
      --navy: #131313;        /* Black Sand */
      --navy-mid: #1e1e1e;
      --bg: #fefaf5;          /* Sand */
      --white: #ffffff;
      --text: #131313;
      --text-light: #827363;  /* Stone */
      --border: #e5dbd0;      /* Shell */
      /* Fora Accent Palette */
      --olive: #77742a;
      --sangria: #870d13;
      --indigo: #333880;
      --stone: #827363;
      --shell: #e5dbd0;
      /* Semantic aliases kept for compatibility */
      --gold: #77742a;        /* Olive ‚Äî primary accent on light bg */
      --gold-light: #e5dbd0;  /* Shell ‚Äî warm cream accent on dark bg */
      --green: #77742a;       /* Olive ‚Äî paid/positive */
      --amber: #333880;       /* Indigo ‚Äî pipeline/in-discussion */
      --red: #870d13;         /* Sangria ‚Äî outstanding/urgent */
      --shadow: 0 2px 12px rgba(0,0,0,0.07);
      --radius: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Blanco', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    .header {
      background: var(--navy);
      color: white;
      padding: 28px 40px 24px;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 20px rgba(0,0,0,0.3);
    }
    .header-left h1 { font-family: 'ChiswickSansText', sans-serif; font-size: 22px; font-weight: 600; letter-spacing: 0.01em; color: var(--gold-light); }
    .header-left p { font-size: 13px; color: rgba(255,255,255,0.5); margin-top: 2px; }
    .header-right { display: flex; align-items: center; gap: 16px; }
    .week-badge {
      background: rgba(195,182,41,0.18);
      border: 1px solid var(--gold);
      color: var(--gold-light);
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
    }

    /* ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ */
    .nav-tabs {
      background: var(--navy-mid);
      padding: 0 40px;
      display: flex;
      gap: 4px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      overflow-x: auto;
    }
    .nav-tab {
      padding: 12px 18px;
      color: rgba(255,255,255,0.5);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      user-select: none;
      white-space: nowrap;
    }
    .nav-tab:hover { color: rgba(255,255,255,0.8); }
    .nav-tab.active { color: var(--gold-light); border-bottom-color: var(--gold); }

    /* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
    .section { display: none; padding: 32px 40px; max-width: 1400px; margin: 0 auto; }
    .section.active { display: block; }

    /* ‚îÄ‚îÄ KPI CARDS ‚îÄ‚îÄ */
    .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
    .kpi-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 22px 24px;
      box-shadow: var(--shadow);
      border-left: 4px solid transparent;
      position: relative;
      overflow: hidden;
    }
    .kpi-card::after {
      content: '';
      position: absolute;
      top: 0; right: 0;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: var(--kpi-color, #eee);
      opacity: 0.08;
      transform: translate(20px, -20px);
    }
    .kpi-card.gold { border-left-color: var(--gold); --kpi-color: var(--gold); }
    .kpi-card.green { border-left-color: var(--green); --kpi-color: var(--green); }
    .kpi-card.amber { border-left-color: var(--amber); --kpi-color: var(--amber); }
    .kpi-card.red { border-left-color: var(--red); --kpi-color: var(--red); }
    .kpi-card.navy { border-left-color: var(--navy); --kpi-color: var(--navy); }
    .kpi-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-light); margin-bottom: 8px; }
    .kpi-value { font-size: 28px; font-weight: 700; color: var(--text); line-height: 1; }
    .kpi-sub { font-size: 12px; color: var(--text-light); margin-top: 6px; }
    .kpi-delta { display: inline-block; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 10px; margin-top: 6px; }
    .kpi-delta.up { background: #ecedd8; color: #444418; }
    .kpi-delta.warn { background: #e8e9f3; color: #2a2e6e; }

    /* ‚îÄ‚îÄ CHART GRID ‚îÄ‚îÄ */
    .chart-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
    .chart-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 24px; }
    .chart-card { background: var(--white); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); }
    .chart-card.wide { grid-column: 1 / -1; }
    .chart-card h3 { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-light); margin-bottom: 20px; }
    .chart-wrap { position: relative; }

    /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
    .section-title { font-family: 'ChiswickSansText', sans-serif; font-size: 22px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
    .section-subtitle { font-size: 13px; color: var(--text-light); margin-bottom: 28px; }

    /* ‚îÄ‚îÄ PIPELINE FUNNEL ‚îÄ‚îÄ */
    .funnel-list { display: flex; flex-direction: column; gap: 2px; }
    .funnel-section-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-light); padding: 14px 12px 4px; }
    .funnel-section-label:first-child { padding-top: 4px; }
    .funnel-item { display: flex; align-items: center; gap: 14px; padding: 9px 12px; border-radius: 8px; cursor: default; transition: background 0.15s; }
    .funnel-item:hover { background: var(--dark-sand, #f3ebe2); }
    .funnel-label { width: 190px; font-size: 13px; font-weight: 500; flex-shrink: 0; line-height: 1.3; }
    .funnel-bar-wrap { flex: 1; background: #ede9e5; border-radius: 6px; height: 16px; overflow: hidden; min-width: 60px; }
    .funnel-bar { height: 100%; border-radius: 6px; transition: width 0.7s cubic-bezier(0.4,0,0.2,1), opacity 0.15s; }
    .funnel-item:hover .funnel-bar { opacity: 0.75; }
    .funnel-count { width: 44px; text-align: right; font-size: 14px; font-weight: 700; color: var(--text); flex-shrink: 0; }
    .funnel-pct { width: 38px; text-align: right; font-size: 11px; color: var(--text-light); flex-shrink: 0; }
    .funnel-val { width: 90px; text-align: right; font-size: 12px; color: var(--text-light); flex-shrink: 0; }

    /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead tr { border-bottom: 2px solid var(--border); }
    thead th { padding: 10px 14px; text-align: left; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-light); white-space: nowrap; }
    tbody tr { border-bottom: 1px solid var(--border); transition: background 0.15s; }
    tbody tr:hover { background: #fafaf8; cursor: pointer; }
    tbody td { padding: 11px 14px; color: var(--text); }
    .badge { display: inline-block; padding: 3px 10px; border-radius: 10px; font-size: 11px; font-weight: 600; white-space: nowrap; }
    .badge-green { background: #ecedd8; color: #444418; }   /* olive tint */
    .badge-amber { background: #e8e9f3; color: #2a2e6e; }   /* indigo tint */
    .badge-red   { background: #f5e8e9; color: #870d13; }   /* sangria */
    .badge-navy  { background: #e8e9f3; color: #333880; }   /* indigo */
    .badge-gold  { background: #ecedd8; color: #444418; }   /* olive tint */
    .badge-gray  { background: #ede9e5; color: #63574a; }   /* dark stone */
    .badge-teal  { background: #e8e9f3; color: #333880; }   /* indigo */

    /* ‚îÄ‚îÄ GEO + BRANDS ‚îÄ‚îÄ */
    .leaderboard { display: flex; flex-direction: column; gap: 6px; }
    .lb-item { display: flex; align-items: center; gap: 10px; }
    .lb-rank { width: 22px; text-align: center; font-size: 11px; font-weight: 700; color: var(--text-light); }
    .lb-label { flex: 1; font-size: 13px; font-weight: 500; }
    .lb-bar-wrap { width: 100px; background: #f0eeea; border-radius: 4px; height: 6px; }
    .lb-bar { height: 100%; border-radius: 4px; background: var(--gold); }
    .lb-count { width: 28px; text-align: right; font-size: 13px; font-weight: 700; color: var(--text); }

    /* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
    .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
    .filter-btn { padding: 7px 16px; border-radius: 20px; border: 1px solid var(--border); background: white; font-size: 12px; font-weight: 600; cursor: pointer; color: var(--text-light); transition: all 0.15s; }
    .filter-btn.active, .filter-btn:hover { background: var(--navy); color: white; border-color: var(--navy); }

    /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
    .search-input-wrap { position: relative; flex: 1; min-width: 260px; }
    .search-input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: white;
      outline: none;
      transition: border-color 0.15s;
    }
    .search-input:focus { border-color: var(--gold); }
    .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 16px; pointer-events: none; }
    .search-select {
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      background: white;
      color: var(--text);
      outline: none;
      cursor: pointer;
    }
    .search-select:focus { border-color: var(--gold); }
    .result-count { font-size: 13px; color: var(--text-light); padding: 4px 0; }

    /* ‚îÄ‚îÄ PARTNER DETAIL DRAWER ‚îÄ‚îÄ */
    .partner-detail {
      display: none;
      background: #fafaf8;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px 24px;
      margin: 0;
    }
    .partner-detail.open { display: block; }
    .detail-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px 24px; margin-bottom: 16px; }
    .detail-field label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-light); display: block; margin-bottom: 3px; }
    .detail-field span { font-size: 13px; color: var(--text); }
    .feature-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }

    /* ‚îÄ‚îÄ NEXT STEPS ‚îÄ‚îÄ */
    .next-steps-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
    .next-step-card { background: var(--white); border-radius: var(--radius); padding: 20px 24px; box-shadow: var(--shadow); display: flex; gap: 16px; align-items: flex-start; }
    .step-number { width: 32px; height: 32px; border-radius: 50%; background: var(--navy); color: var(--gold-light); font-size: 14px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .step-content h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .step-content p { font-size: 13px; color: var(--text-light); line-height: 1.5; }
    .step-tag { display: inline-block; margin-top: 8px; padding: 3px 10px; border-radius: 10px; font-size: 11px; font-weight: 600; }
    .step-tag.urgent { background: #f5e8e9; color: #870d13; }
    .step-tag.this-week { background: #e8e9f3; color: #2a2e6e; }
    .step-tag.ongoing { background: #ede9e5; color: #827363; }
    .step-tag.nice { background: #ecedd8; color: #444418; }

    /* ‚îÄ‚îÄ TEAM UPDATES ‚îÄ‚îÄ */
    .updates-area { background: var(--white); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); margin-bottom: 24px; }
    .updates-area h3 { font-size: 15px; font-weight: 600; margin-bottom: 16px; }
    .update-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    .update-item { display: flex; gap: 12px; padding: 14px 16px; border-radius: 8px; border: 1px solid var(--border); background: #fafaf8; }
    .update-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
    .update-dot.gold { background: var(--gold); }
    .update-dot.green { background: var(--green); }
    .update-dot.amber { background: var(--amber); }
    .update-dot.navy { background: var(--navy); }
    .update-text { font-size: 13px; line-height: 1.5; }
    .notes-box { width: 100%; min-height: 100px; border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; font-size: 13px; color: var(--text); font-family: inherit; resize: vertical; background: #fafaf8; outline: none; }
    .notes-box:focus { border-color: var(--gold); }
    .notes-label { font-size: 12px; font-weight: 600; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 8px; }

    /* ‚îÄ‚îÄ SCENARIO PLANNER ‚îÄ‚îÄ */
    .planner-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
    .planner-card { background: var(--white); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); }
    .planner-card h3 { font-size: 15px; font-weight: 700; margin-bottom: 20px; color: var(--text); }
    .goal-input-wrap { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
    .goal-input {
      flex: 1;
      padding: 14px 18px;
      border: 2px solid var(--gold);
      border-radius: 10px;
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
      background: white;
      outline: none;
      max-width: 280px;
    }
    .goal-label { font-size: 13px; color: var(--text-light); }
    .progress-wrap { margin-bottom: 24px; }
    .progress-label-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
    .progress-label { font-size: 13px; font-weight: 600; color: var(--text); }
    .progress-pct { font-size: 22px; font-weight: 700; color: var(--olive); }
    .progress-bar-bg { width: 100%; height: 16px; background: #ede9e5; border-radius: 8px; overflow: hidden; }
    .progress-bar-fg { height: 100%; border-radius: 8px; background: linear-gradient(90deg, var(--olive), #a3a040); transition: width 0.5s ease; }
    .gap-amount { font-size: 28px; font-weight: 700; }
    .gap-label { font-size: 13px; color: var(--text-light); margin-top: 4px; }

    .scenario-list { display: flex; flex-direction: column; gap: 16px; }
    .scenario-card { border: 1px solid var(--border); border-radius: 10px; padding: 16px 20px; background: #fafaf8; }
    .scenario-card h4 { font-size: 14px; font-weight: 700; margin-bottom: 10px; }
    .scenario-rows { display: flex; flex-direction: column; gap: 6px; }
    .scenario-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    .scenario-row .pkg { color: var(--text-light); }
    .scenario-row .qty { font-weight: 700; color: var(--text); }

    .pkg-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    .pkg-table th { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-light); padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--border); }
    .pkg-table td { padding: 10px 12px; font-size: 13px; border-bottom: 1px solid #f0eeea; }
    .pkg-table tr:last-child td { border-bottom: none; }
    .pkg-price-input { width: 90px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; text-align: right; outline: none; }
    .pkg-price-input:focus { border-color: var(--gold); }
    .mini-progress { height: 6px; background: #f0eeea; border-radius: 3px; margin-top: 4px; overflow: hidden; }
    .mini-progress-fill { height: 100%; border-radius: 3px; background: var(--gold); }

    /* ‚îÄ‚îÄ AMOUNT ‚îÄ‚îÄ */
    .amount { font-variant-numeric: tabular-nums; }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 900px) {
      .kpi-grid { grid-template-columns: 1fr 1fr; }
      .chart-grid-2, .chart-grid-3, .planner-grid, .next-steps-grid { grid-template-columns: 1fr; }
      .section { padding: 24px 20px; }
      .header { padding: 20px; }
      .nav-tabs { padding: 0 20px; }
      .detail-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 600px) {
      .kpi-grid { grid-template-columns: 1fr; }
      .detail-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <div style="display:flex; align-items:center; gap:14px; margin-bottom:6px;">
      <span style="font-family:'DM Sans',sans-serif; font-size:11px; font-weight:700; letter-spacing:0.18em; text-transform:uppercase; color:var(--gold); border:1px solid var(--gold); padding:4px 10px; border-radius:4px;">FORA</span>
      <span style="width:1px; height:22px; background:rgba(255,255,255,0.2);"></span>
      <span style="font-size:11px; font-weight:600; letter-spacing:0.1em; text-transform:uppercase; color:rgba(255,255,255,0.4);">Travel Partners</span>
    </div>
    <h1>Amplify 2026 ‚Äî Partner Dashboard</h1>
    <p id="headerSubtitle">Loading data‚Ä¶</p>
  </div>
  <div class="header-right">
    <span class="week-badge" id="weekBadge">‚Äî</span>
  </div>
</div>

<!-- NAV TABS -->
<div class="nav-tabs">
  <div class="nav-tab active" onclick="showTab('overview',this)">Overview</div>
  <div class="nav-tab" onclick="showTab('invoices',this)">Invoices</div>
  <div class="nav-tab" onclick="showTab('partners',this)">Partners</div>
  <div class="nav-tab" onclick="showTab('search',this)">Partner Search</div>
  <div class="nav-tab" onclick="showTab('planner',this)">Scenario Planner</div>
  <div class="nav-tab" onclick="showTab('next-steps',this)">Next Steps</div>
  <div class="nav-tab" onclick="showTab('team',this)">Team Updates</div>
</div>


<!-- ===== OVERVIEW ===== -->
<div id="tab-overview" class="section active">
  <h2 class="section-title">Amplify 2026 at a Glance</h2>
  <p class="section-subtitle" id="overviewSubtitle">Full program status as of this week's data export.</p>

  <div class="kpi-grid">
    <div class="kpi-card gold">
      <div class="kpi-label">Signed Partners</div>
      <div class="kpi-value" id="kpiSignedCount">‚Äî</div>
      <div class="kpi-sub">Tier 1 ¬∑ Brand Spotlight ¬∑ Tier 2 ¬∑ New Opening ¬∑ Marketing Complete</div>
    </div>
    <div class="kpi-card navy">
      <div class="kpi-label">Total Value Signed</div>
      <div class="kpi-value" id="kpiTotalSigned">‚Äî</div>
      <div class="kpi-sub">Across all signed packages</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">Collected (Paid)</div>
      <div class="kpi-value" id="kpiPaid">‚Äî</div>
      <div class="kpi-sub" id="kpiPaidSub">‚Äî</div>
      <span class="kpi-delta up">‚ñ≤ on track</span>
    </div>
    <div class="kpi-card amber">
      <div class="kpi-label">Total Value in Pipeline</div>
      <div class="kpi-value" id="kpiTotalPipeline">‚Äî</div>
      <div class="kpi-sub">Signed + In Discussion + Needs Invoice</div>
    </div>
  </div>

  <div class="kpi-grid" style="grid-template-columns: repeat(4,1fr); margin-bottom:32px;">
    <div class="kpi-card amber">
      <div class="kpi-label">In Discussion</div>
      <div class="kpi-value" id="kpiInDiscussion">‚Äî</div>
      <div class="kpi-sub" id="kpiInDiscussionSub">‚Äî</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">Needs Invoice</div>
      <div class="kpi-value" id="kpiNeedsInvoice">‚Äî</div>
      <div class="kpi-sub" id="kpiNeedsInvoiceSub">‚Äî</div>
    </div>
    <div class="kpi-card navy">
      <div class="kpi-label">Final Follow Up</div>
      <div class="kpi-value" id="kpiFinalFollowUp">‚Äî</div>
      <div class="kpi-sub" id="kpiFinalFollowUpSub">‚Äî</div>
    </div>
    <div class="kpi-card gold">
      <div class="kpi-label">Marketing Complete</div>
      <div class="kpi-value" id="kpiMarketingComplete">‚Äî</div>
      <div class="kpi-sub">Deliverables fulfilled</div>
    </div>
  </div>

  <div class="chart-grid-2">
    <div class="chart-card">
      <h3>Revenue by Package</h3>
      <div class="chart-wrap" style="height:240px;"><canvas id="revenueChart"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>Invoice Collection Status</h3>
      <div class="chart-wrap" style="height:240px;"><canvas id="invoiceChart"></canvas></div>
    </div>
  </div>

  <div class="chart-grid-3">
    <div class="chart-card">
      <h3>Signed Partners by Tier</h3>
      <div class="chart-wrap" style="height:200px;"><canvas id="tierChart"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>Deliverable Quarter Preference</h3>
      <div class="chart-wrap" style="height:200px;"><canvas id="quarterChart"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>Features Booked (Signed)</h3>
      <div class="chart-wrap" style="height:200px;"><canvas id="featuresChart"></canvas></div>
    </div>
  </div>

  <!-- Pipeline funnel -->
  <div class="chart-grid-2" style="margin-top:4px;">
    <div class="chart-card wide">
      <h3>Full Pipeline ‚Äî All Stages</h3>
      <div style="display:flex; align-items:center; gap:14px; padding: 0 12px 6px; border-bottom: 1px solid var(--border); margin-bottom:4px;">
        <div style="width:190px; flex-shrink:0;"></div>
        <div style="flex:1; min-width:60px;"></div>
        <div style="width:44px; text-align:right; font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--text-light); flex-shrink:0;">Partners</div>
        <div style="width:38px; text-align:right; font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--text-light); flex-shrink:0;">% total</div>
        <div style="width:90px; text-align:right; font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--text-light); flex-shrink:0;">Value</div>
      </div>
      <div class="funnel-list" id="funnelList"></div>
    </div>
  </div>
</div>


<!-- ===== INVOICES ===== -->
<div id="tab-invoices" class="section">
  <h2 class="section-title">Invoice Tracker</h2>
  <p class="section-subtitle" id="invoiceSubtitle">Invoice status across all signed partners.</p>

  <div class="kpi-grid" style="margin-bottom:28px;">
    <div class="kpi-card green">
      <div class="kpi-label">Paid</div>
      <div class="kpi-value" id="invPaid">‚Äî</div>
      <div class="kpi-sub" id="invPaidSub">‚Äî</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">Outstanding</div>
      <div class="kpi-value" id="invOutstanding">‚Äî</div>
      <div class="kpi-sub">Invoices sent, awaiting payment</div>
    </div>
    <div class="kpi-card amber">
      <div class="kpi-label">Waiting on Billing Info</div>
      <div class="kpi-value" id="invWaiting">‚Äî</div>
      <div class="kpi-sub" id="invWaitingSub">‚Äî</div>
    </div>
    <div class="kpi-card navy">
      <div class="kpi-label">Needs Invoice Sent</div>
      <div class="kpi-value" id="invNeedsInvoice">‚Äî</div>
      <div class="kpi-sub" id="invNeedsInvoiceSub">‚Äî</div>
    </div>
  </div>

  <div class="chart-card">
    <h3>Partners Needing Invoices ‚Äî Action Required</h3>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Partner Name</th>
            <th>Package</th>
            <th>Amount</th>
            <th>Country</th>
            <th>Priority</th>
            <th>Streak</th>
          </tr>
        </thead>
        <tbody id="needsInvoiceTbody"></tbody>
      </table>
    </div>
  </div>
</div>


<!-- ===== PARTNERS ===== -->
<div id="tab-partners" class="section">
  <h2 class="section-title">Partner Overview</h2>
  <p class="section-subtitle">Breakdown of signed Amplify 2026 partners by geography, brand, and group.</p>

  <div class="chart-grid-3">
    <div class="chart-card">
      <h3>Top Countries</h3>
      <div class="leaderboard" id="countryLeaderboard"></div>
    </div>
    <div class="chart-card">
      <h3>Top Hotel Groups</h3>
      <div class="leaderboard" id="groupLeaderboard"></div>
    </div>
    <div class="chart-card">
      <h3>Top Brands</h3>
      <div class="leaderboard" id="brandLeaderboard"></div>
    </div>
  </div>

  <div class="chart-grid-2">
    <div class="chart-card">
      <h3>Partner Mix by Package</h3>
      <div class="chart-wrap" style="height:220px;"><canvas id="partnerTypeChart"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>Feature Deliverables Booked</h3>
      <div class="chart-wrap" style="height:220px;"><canvas id="featuresChart2"></canvas></div>
    </div>
  </div>
</div>


<!-- ===== PARTNER SEARCH ===== -->
<div id="tab-search" class="section">
  <h2 class="section-title">Partner Search</h2>
  <p class="section-subtitle">Look up any partner to see their Streak details ‚Äî package, invoice status, features, and more.</p>

  <div class="filter-bar">
    <div class="search-input-wrap">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="partnerSearch" placeholder="Search by name, brand, group, or country‚Ä¶" oninput="filterPartners()">
    </div>
    <select class="search-select" id="stageFilter" onchange="filterPartners()">
      <option value="">All Stages</option>
      <option value="Tier 1">Tier 1</option>
      <option value="Tier 2">Tier 2</option>
      <option value="Brand Spotlight">Brand Spotlight</option>
      <option value="New Opening">New Opening</option>
      <option value="Marketing Complete">Marketing Complete</option>
      <option value="Needs Invoice">Needs Invoice</option>
      <option value="In Discussion">In Discussion</option>
      <option value="Final Follow Up">Final Follow Up</option>
      <option value="Needs Contact">Needs Contact</option>
      <option value="Declined">Declined</option>
      <option value="Do Not Invite">Do Not Invite</option>
    </select>
    <select class="search-select" id="invoiceFilter" onchange="filterPartners()">
      <option value="">All Invoice Statuses</option>
      <option value="Paid">Paid</option>
      <option value="Outstanding">Outstanding</option>
      <option value="To Invoice">To Invoice</option>
      <option value="Waiting for billing details">Waiting for billing details</option>
      <option value="In Kind Sponsorship">In Kind Sponsorship</option>
    </select>
    <select class="search-select" id="quarterFilter" onchange="filterPartners()">
      <option value="">All Quarters</option>
      <option value="Q1">Q1</option>
      <option value="Q2">Q2</option>
      <option value="Q3">Q3</option>
      <option value="Q4">Q4</option>
      <option value="August">August</option>
      <option value="TBD">TBD (none set)</option>
    </select>
  </div>
  <div class="result-count" id="searchResultCount"></div>

  <div class="chart-card" style="padding: 0; overflow: hidden; margin-top: 12px;">
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Partner Name</th>
            <th>Stage</th>
            <th>Amount</th>
            <th>Invoice Status</th>
            <th>Quarter(s)</th>
            <th>Country</th>
            <th>Features</th>
            <th>Links</th>
          </tr>
        </thead>
        <tbody id="partnerSearchTbody"></tbody>
      </table>
    </div>
  </div>
</div>


<!-- ===== SCENARIO PLANNER ===== -->
<div id="tab-planner" class="section">
  <h2 class="section-title">Scenario Planner</h2>
  <p class="section-subtitle">Set a revenue goal and explore what package mix it takes to get there.</p>

  <!-- Goal input + Progress -->
  <div class="planner-grid">
    <div class="planner-card">
      <h3>Revenue Goal</h3>
      <div class="goal-input-wrap">
        <div style="font-size:22px; font-weight:700; color:var(--text-light);">$</div>
        <input type="text" class="goal-input" id="goalInput" value="1,500,000" oninput="fmtGoalInput(this); updatePlanner()">
      </div>
      <div class="progress-wrap">
        <div class="progress-label-row">
          <span class="progress-label">Current progress</span>
          <span class="progress-pct" id="plannerPct">‚Äî%</span>
        </div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fg" id="plannerProgressBar" style="width:0%"></div>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:6px;">
          <span style="font-size:12px; color:var(--text-light);" id="plannerSignedLabel">‚Äî</span>
          <span style="font-size:12px; color:var(--text-light);" id="plannerGoalLabel">‚Äî</span>
        </div>
      </div>
      <div style="display:flex; gap:24px;">
        <div>
          <div class="kpi-label">Gap to close</div>
          <div class="gap-amount" id="plannerGap" style="color:var(--red);">‚Äî</div>
          <div class="gap-label">additional revenue needed</div>
        </div>
        <div>
          <div class="kpi-label">Pipeline available</div>
          <div class="gap-amount" id="plannerPipelineAvail" style="color:var(--amber);">‚Äî</div>
          <div class="gap-label">in active discussions</div>
        </div>
      </div>
    </div>

    <div class="planner-card">
      <h3>Package Pricing (editable)</h3>
      <table class="pkg-table">
        <thead>
          <tr>
            <th>Package</th>
            <th>Price</th>
            <th>Current</th>
            <th>Revenue</th>
          </tr>
        </thead>
        <tbody id="pkgPricingTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Scenarios -->
  <div class="chart-card" style="margin-bottom:24px;">
    <h3>How to close the gap ‚Äî 3 scenarios</h3>
    <div id="scenarioList" class="scenario-list"></div>
  </div>

  <!-- Package fill rates -->
  <div class="chart-card">
    <h3>Package Fill Rate ‚Äî Current vs Goal</h3>
    <div id="fillRateTable"></div>
  </div>
</div>


<!-- ===== NEXT STEPS ===== -->
<div id="tab-next-steps" class="section">
  <h2 class="section-title">Suggested Next Steps</h2>
  <p class="section-subtitle">Data-driven priorities for the week ahead.</p>
  <div class="next-steps-grid" id="nextStepsGrid"></div>
</div>


<!-- ===== TEAM UPDATES ===== -->
<div id="tab-team" class="section">
  <h2 class="section-title">Team Updates</h2>
  <p class="section-subtitle">Program highlights and weekly notes. Use the notes field to add context before sharing.</p>

  <div class="updates-area">
    <h3>This Week's Highlights</h3>
    <div class="update-list" id="updateList"></div>
    <div class="notes-label">Weekly Notes (add context before sharing)</div>
    <textarea class="notes-box" id="weeklyNotes" placeholder="Add any team notes, context, or updates here before sharing this dashboard‚Ä¶"></textarea>
  </div>

  <div class="chart-card" style="margin-bottom:24px;">
    <h3>Program Snapshot ‚Äî Copy-Paste Summary</h3>
    <div id="copySnapshot" style="background:#fafaf8; border:1px solid var(--border); border-radius:8px; padding:16px; font-size:13px; line-height:1.8; white-space:pre-wrap; font-family:monospace;"></div>
    <button onclick="copySnapshot()" style="margin-top:12px; padding:8px 20px; background:var(--navy); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer;">Copy Summary</button>
  </div>
</div>


<script>
// ‚îÄ‚îÄ Tab Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(tab, el) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  if (el) el.classList.add('active');
}

// ‚îÄ‚îÄ Colors (Fora brand palette) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const OLIVE  = '#77742a';  // Fora Olive
const INDIGO = '#333880';  // Fora Indigo
const SANG   = '#870d13';  // Fora Sangria
const STONE  = '#827363';  // Fora Stone
const DSHELL = '#bdb1a4';  // Fora Dark Shell
const DSTONE = '#63574a';  // Fora Dark Stone
const BLACK  = '#131313';  // Fora Black Sand
// Semantic aliases
const GOLD   = OLIVE;
const NAVY   = BLACK;
const GREEN  = OLIVE;
const AMBER  = INDIGO;
const RED    = SANG;
const NAVY2  = '#1e1e1e';
const GOLD2  = '#e5dbd0';  // Fora Shell
const TEAL   = INDIGO;
const PURPLE = STONE;

Chart.defaults.font.family = "'Blanco', -apple-system, BlinkMacSystemFont, sans-serif";
Chart.defaults.font.size   = 12;
Chart.defaults.color       = '#827363';

// ‚îÄ‚îÄ Formatters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fmt  = n => '$' + Math.round(n).toLocaleString();
const fmtK = n => '$' + (Math.round(n/1000)) + 'K';
const pct  = (a, b) => b ? Math.round(a/b*100) + '%' : '0%';

function stageBadge(stage) {
  const cls = {
    'Tier 1': 'badge-gold', 'Tier 2': 'badge-teal',
    'Brand Spotlight': 'badge-navy', 'New Opening': 'badge-amber',
    'Marketing Complete': 'badge-green',
    'Needs Invoice': 'badge-red', 'In Discussion': 'badge-amber',
    'Final Follow Up': 'badge-amber', 'Needs Contact': 'badge-gray',
    'Needs Review': 'badge-gray', 'Declined': 'badge-red',
    'Do Not Invite': 'badge-gray',
  }[stage] || 'badge-gray';
  return `<span class="badge ${cls}">${stage}</span>`;
}

function invoiceBadge(status) {
  if (!status) return '<span class="badge badge-gray">‚Äî</span>';
  const cls = {
    'Paid': 'badge-green', 'Outstanding': 'badge-red',
    'To Invoice': 'badge-amber', 'Waiting for billing details': 'badge-amber',
    'In Kind Sponsorship': 'badge-navy', 'Invoice held': 'badge-gray',
  }[status] || 'badge-gray';
  return `<span class="badge ${cls}">${status}</span>`;
}

// ‚îÄ‚îÄ Leaderboard builder ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildLeaderboard(id, data) {
  const max = data[0] ? data[0][1] : 1;
  const el = document.getElementById(id);
  data.forEach(([label, count], i) => {
    el.innerHTML += `
      <div class="lb-item">
        <div class="lb-rank">${i+1}</div>
        <div class="lb-label">${label}</div>
        <div class="lb-bar-wrap"><div class="lb-bar" style="width:${(count/max)*100}%"></div></div>
        <div class="lb-count">${count}</div>
      </div>`;
  });
}

// ‚îÄ‚îÄ Main data loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init() {
  if (typeof AMPLIFY_DATA === 'undefined') {
    document.getElementById('headerSubtitle').textContent = '‚ö† data.js not found ‚Äî run python3 update.py';
    return;
  }
  const D = AMPLIFY_DATA;

  // Header
  document.getElementById('headerSubtitle').textContent =
    `Data refreshed ${D.lastUpdated} ¬∑ ${D.signedCount} signed partners`;
  document.getElementById('weekBadge').textContent = `Updated ${D.lastUpdated}`;
  document.getElementById('overviewSubtitle').textContent =
    `Full program status as of ${D.lastUpdated}.`;

  // ‚îÄ‚îÄ Overview KPIs ‚îÄ‚îÄ
  document.getElementById('kpiSignedCount').textContent    = D.signedCount;
  document.getElementById('kpiTotalSigned').textContent    = fmt(D.totalSigned);
  document.getElementById('kpiPaid').textContent           = fmt(D.paid);
  document.getElementById('kpiPaidSub').textContent        = pct(D.paid, D.totalSigned) + ' of total signed';
  document.getElementById('kpiTotalPipeline').textContent  = fmt(D.totalPipeline);
  document.getElementById('kpiInDiscussion').textContent   = fmt(D.inDiscussion);
  document.getElementById('kpiInDiscussionSub').textContent = `${D.inDiscussionCount} partners in active conversation`;
  document.getElementById('kpiNeedsInvoice').textContent   = fmt(D.needsInvoice);
  document.getElementById('kpiNeedsInvoiceSub').textContent = `${D.needsInvoiceCount} signed partners not yet invoiced`;
  document.getElementById('kpiFinalFollowUp').textContent  = fmt(D.finalFollowUp);
  document.getElementById('kpiFinalFollowUpSub').textContent = `${D.finalFollowUpCount} partners ¬∑ last touch before decision`;
  document.getElementById('kpiMarketingComplete').textContent = fmt(D.marketingComplete);

  // ‚îÄ‚îÄ Revenue by Package chart ‚îÄ‚îÄ
  const stageLabels = Object.keys(D.byStage);
  const stageColors = [OLIVE, INDIGO, SANG, STONE, DSHELL, BLACK];
  new Chart(document.getElementById('revenueChart'), {
    type: 'bar',
    data: {
      labels: stageLabels,
      datasets: [{ label: 'Revenue', data: Object.values(D.byStage), backgroundColor: stageColors, borderRadius: 6, borderSkipped: false }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ' ' + fmt(ctx.raw) } } },
      scales: { y: { ticks: { callback: v => fmtK(v) }, grid: { color: '#f0eeea' } }, x: { grid: { display: false } } }
    }
  });

  // ‚îÄ‚îÄ Invoice donut ‚îÄ‚îÄ
  new Chart(document.getElementById('invoiceChart'), {
    type: 'doughnut',
    data: {
      labels: ['Paid', 'Outstanding', 'Needs Invoice', 'Waiting on Billing'],
      datasets: [{ data: [D.paid, D.outstanding, D.needsInvoice, D.waitingBilling], backgroundColor: [OLIVE, SANG, DSHELL, INDIGO], borderWidth: 2, borderColor: '#fff' }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '65%',
      plugins: {
        legend: { position: 'bottom', labels: { padding: 16, boxWidth: 12 } },
        tooltip: { callbacks: { label: ctx => ' ' + fmt(ctx.raw) } }
      }
    }
  });

  // ‚îÄ‚îÄ Tier donut ‚îÄ‚îÄ
  new Chart(document.getElementById('tierChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(D.countByStage),
      datasets: [{ data: Object.values(D.countByStage), backgroundColor: [OLIVE, INDIGO, SANG, STONE, DSHELL], borderWidth: 2, borderColor: '#fff' }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '60%',
      plugins: { legend: { position: 'bottom', labels: { padding: 12, boxWidth: 12 } } }
    }
  });

  // ‚îÄ‚îÄ Quarter chart ‚îÄ‚îÄ
  const qLabels = ['Q1', 'Q2', 'Q3', 'Q4', 'August', 'TBD'];
  const qData   = qLabels.map(q => D.quarters[q] || 0);
  new Chart(document.getElementById('quarterChart'), {
    type: 'bar',
    data: { labels: qLabels, datasets: [{ data: qData, backgroundColor: [OLIVE, INDIGO, SANG, STONE, DSHELL, DSTONE], borderRadius: 6, borderSkipped: false }] },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ' ' + ctx.raw + ' partners' } } },
      scales: { y: { grid: { color: '#f0eeea' } }, x: { grid: { display: false } } }
    }
  });

  // ‚îÄ‚îÄ Features chart ‚îÄ‚îÄ
  const fLabels = Object.keys(D.features);
  const fData   = Object.values(D.features);
  new Chart(document.getElementById('featuresChart'), {
    type: 'bar',
    data: { labels: fLabels, datasets: [{ data: fData, backgroundColor: [OLIVE, INDIGO, SANG, STONE, DSHELL, DSTONE, BLACK], borderRadius: 6, borderSkipped: false }] },
    options: {
      responsive: true, maintainAspectRatio: false, indexAxis: 'y',
      plugins: { legend: { display: false } },
      scales: { x: { grid: { color: '#f0eeea' } }, y: { grid: { display: false } } }
    }
  });

  // Funnel
  const funnelColors = {
    '5014': OLIVE, '5015': DSHELL, '5016': BLACK, '5017': STONE, '5007': INDIGO,
    '5011': SANG,  '5004': INDIGO, '5001': STONE,
    '5013': DSHELL, '5010': '#c0bcb3', '5008': SANG, '5009': '#888',
  };
  const maxFunnelCount = Math.max(...D.funnel.map(f => f.count));
  const totalFunnelCount = D.funnel.reduce((s, f) => s + f.count, 0);
  const fl = document.getElementById('funnelList');
  const signedKeys   = new Set(['5014','5015','5016','5017','5007']);
  const pipelineKeys = new Set(['5011','5004','5001']);
  const groupLabels  = { signed: 'Signed Partners', pipeline: 'In Pipeline', other: 'Other Stages' };
  let currentGroup   = null;

  D.funnel.forEach(f => {
    const group = signedKeys.has(f.stageKey) ? 'signed'
                : pipelineKeys.has(f.stageKey) ? 'pipeline' : 'other';
    if (group !== currentGroup) {
      currentGroup = group;
      const hdr = document.createElement('div');
      hdr.className = 'funnel-section-label';
      hdr.textContent = groupLabels[group];
      fl.appendChild(hdr);
    }

    const color   = funnelColors[f.stageKey] || '#aaa';
    const valStr  = f.value ? fmt(f.value) : '‚Äî';
    const pctStr  = totalFunnelCount > 0 ? Math.round(f.count / totalFunnelCount * 100) + '%' : '0%';
    const barW    = maxFunnelCount ? (f.count / maxFunnelCount) * 100 : 0;
    const tip     = `${f.label}: ${f.count} partner${f.count !== 1 ? 's' : ''}${f.value ? ' ¬∑ ' + fmt(f.value) : ''} ¬∑ ${pctStr} of all stages`;

    const item = document.createElement('div');
    item.className = 'funnel-item';
    item.title = tip;
    item.innerHTML = `
      <div class="funnel-label">${f.label}</div>
      <div class="funnel-bar-wrap">
        <div class="funnel-bar" style="width:${barW}%; background:${color};"></div>
      </div>
      <div class="funnel-count">${f.count}</div>
      <div class="funnel-pct">${pctStr}</div>
      <div class="funnel-val">${valStr}</div>`;
    fl.appendChild(item);
  });

  // ‚îÄ‚îÄ Invoices tab ‚îÄ‚îÄ
  document.getElementById('invPaid').textContent          = fmt(D.paid);
  document.getElementById('invPaidSub').textContent       = pct(D.paid, D.totalSigned) + ' of total signed value';
  document.getElementById('invOutstanding').textContent   = fmt(D.outstanding);
  document.getElementById('invWaiting').textContent       = fmt(D.waitingBilling);
  document.getElementById('invNeedsInvoice').textContent  = fmt(D.needsInvoice);
  document.getElementById('invNeedsInvoiceSub').textContent = `${D.needsInvoiceCount} signed partners`;
  document.getElementById('invoiceSubtitle').textContent  =
    `${fmt(D.needsInvoice)} in signed partners not yet invoiced. ${fmt(D.outstanding)} outstanding.`;

  // Needs invoice table
  const needsInvoicePartners = (D.partners || [])
    .filter(p => p.stageKey === '5011' || p.invoiceStatus === 'To Invoice')
    .sort((a,b) => b.price - a.price);
  const invTbody = document.getElementById('needsInvoiceTbody');
  if (needsInvoicePartners.length === 0) {
    invTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-light);padding:20px;">All signed partners have been invoiced ‚Äî great work!</td></tr>';
  } else {
    needsInvoicePartners.forEach(p => {
      const priority = p.price >= 8000 ? '<span class="badge badge-red">High</span>' :
                       p.price >= 4000 ? '<span class="badge badge-amber">Medium</span>' :
                       '<span class="badge badge-gray">Standard</span>';
      invTbody.innerHTML += `
        <tr>
          <td>${p.name}</td>
          <td>${stageBadge(p.stage)}</td>
          <td class="amount">${p.price ? fmt(p.price) : '‚Äî'}</td>
          <td>${p.country || '‚Äî'}</td>
          <td>${priority}</td>
          <td><a href="${p.streakUrl}" target="_blank" style="color:var(--gold);font-weight:600;text-decoration:none;">View ‚Üí</a></td>
        </tr>`;
    });
  }

  // ‚îÄ‚îÄ Partners tab ‚îÄ‚îÄ
  buildLeaderboard('countryLeaderboard', D.topCountries);
  buildLeaderboard('groupLeaderboard',   D.topGroups);
  buildLeaderboard('brandLeaderboard',   D.topBrands);

  new Chart(document.getElementById('partnerTypeChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(D.countByStage),
      datasets: [{ data: Object.values(D.countByStage), backgroundColor: [OLIVE, INDIGO, SANG, STONE, DSHELL], borderWidth: 2, borderColor: '#fff' }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '60%',
      plugins: { legend: { position: 'bottom', labels: { padding: 16, boxWidth: 12 } } }
    }
  });

  new Chart(document.getElementById('featuresChart2'), {
    type: 'bar',
    data: { labels: fLabels, datasets: [{ label: 'Partners booked', data: fData, backgroundColor: [OLIVE, INDIGO, SANG, STONE, DSHELL, DSTONE, BLACK], borderRadius: 6, borderSkipped: false }] },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: { y: { grid: { color: '#f0eeea' } }, x: { grid: { display: false } } }
    }
  });

  // ‚îÄ‚îÄ Partner Search ‚îÄ‚îÄ
  window._allPartners = D.partners || [];
  filterPartners();

  // ‚îÄ‚îÄ Scenario Planner ‚îÄ‚îÄ
  initPlanner(D);

  // ‚îÄ‚îÄ Next Steps ‚îÄ‚îÄ
  buildNextSteps(D);

  // ‚îÄ‚îÄ Team Updates ‚îÄ‚îÄ
  buildTeamUpdates(D);
}

// ‚îÄ‚îÄ Partner Search (debounced + lazy detail rendering) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _searchTimer = null;
const _renderedDetails = new Set();

function filterPartners() {
  clearTimeout(_searchTimer);
  _searchTimer = setTimeout(_runFilter, 180);
}

function _runFilter() {
  const query   = document.getElementById('partnerSearch').value.toLowerCase().trim();
  const stage   = document.getElementById('stageFilter').value;
  const invoice = document.getElementById('invoiceFilter').value;
  const quarter = document.getElementById('quarterFilter').value;

  let results = window._allPartners || [];
  if (query)   results = results.filter(p =>
    p.name.toLowerCase().includes(query) ||
    (p.brand || '').toLowerCase().includes(query) ||
    (p.group || '').toLowerCase().includes(query) ||
    (p.country || '').toLowerCase().includes(query)
  );
  if (stage)   results = results.filter(p => p.stage === stage);
  if (invoice) results = results.filter(p => p.invoiceStatus === invoice);
  if (quarter) {
    if (quarter === 'TBD') results = results.filter(p => !p.quarters || p.quarters.length === 0);
    else results = results.filter(p => (p.quarters || []).includes(quarter));
  }

  document.getElementById('searchResultCount').textContent =
    `${results.length} partner${results.length !== 1 ? 's' : ''} found`;

  const tbody = document.getElementById('partnerSearchTbody');
  const frag  = document.createDocumentFragment();
  _renderedDetails.clear();
  tbody.innerHTML = '';

  if (results.length === 0) {
    const tr = document.createElement('tr');
    tr.innerHTML = '<td colspan="8" style="text-align:center;color:var(--text-light);padding:24px;">No partners match your search.</td>';
    tbody.appendChild(tr);
    return;
  }

  results.slice(0, 100).forEach(p => {
    const featStr = (p.features || []).map(f => typeof f === 'object' ? f.name : f).slice(0, 3).join(', ') +
      ((p.features || []).length > 3 ? ' +' + ((p.features || []).length - 3) : '');
    const qStr = (p.quarters || []).length > 0
      ? (p.quarters || []).join(', ')
      : '<span style="color:var(--text-light)">TBD</span>';

    // Main row ‚Äî built via innerHTML on a detached element (fast)
    const mainTr = document.createElement('tr');
    mainTr.innerHTML = `
      <td><strong>${p.name}</strong></td>
      <td>${stageBadge(p.stage)}</td>
      <td class="amount">${p.price ? fmt(p.price) : '‚Äî'}</td>
      <td>${invoiceBadge(p.invoiceStatus)}</td>
      <td>${qStr}</td>
      <td>${p.country || '‚Äî'}</td>
      <td style="font-size:12px;color:var(--text-light);">${featStr || '‚Äî'}</td>
      <td>
        <a href="${p.streakUrl}" target="_blank" style="color:var(--gold);font-weight:600;text-decoration:none;" onclick="event.stopPropagation()">Streak</a>
        ${p.invoiceUrl ? ` ¬∑ <a href="${p.invoiceUrl}" target="_blank" style="color:var(--green);font-weight:600;text-decoration:none;" onclick="event.stopPropagation()">Invoice</a>` : ''}
      </td>`;
    mainTr.addEventListener('click', () => _expandDetail(mainTr, p));
    frag.appendChild(mainTr);

    // Detail row ‚Äî empty placeholder, filled lazily on first click
    const detailTr = document.createElement('tr');
    const detailTd = document.createElement('td');
    detailTd.setAttribute('colspan', '8');
    detailTd.style.padding = '0';
    const detailDiv = document.createElement('div');
    detailDiv.className = 'partner-detail';
    detailDiv.id = 'detail-' + p.key;
    detailTd.appendChild(detailDiv);
    detailTr.appendChild(detailTd);
    frag.appendChild(detailTr);
  });

  if (results.length > 100) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td colspan="8" style="text-align:center;color:var(--text-light);padding:12px;">Showing first 100 of ${results.length} results ‚Äî use filters to narrow down.</td>`;
    frag.appendChild(tr);
  }

  tbody.appendChild(frag);
}

function _expandDetail(rowEl, p) {
  const div = document.getElementById('detail-' + p.key);
  if (!div) return;
  // Lazy-render content only on first open
  if (!_renderedDetails.has(p.key)) {
    _renderedDetails.add(p.key);
    div.innerHTML = `
      <div class="detail-grid">
        <div class="detail-field"><label>Stage</label><span>${stageBadge(p.stage)}</span></div>
        <div class="detail-field"><label>Package Value</label><span>${p.price ? fmt(p.price) : '‚Äî'}</span></div>
        <div class="detail-field"><label>Invoice Status</label><span>${invoiceBadge(p.invoiceStatus)}</span></div>
        <div class="detail-field"><label>Country</label><span>${p.country || '‚Äî'}</span></div>
        <div class="detail-field"><label>Quarter(s)</label><span>${(p.quarters||[]).length ? p.quarters.join(', ') : 'TBD'}</span></div>
        <div class="detail-field"><label>Brand</label><span>${p.brand || '‚Äî'}</span></div>
        <div class="detail-field"><label>Hotel Group</label><span>${p.group || '‚Äî'}</span></div>
        <div class="detail-field"><label>Contact Email</label><span>${p.email ? `<a href="mailto:${p.email}" style="color:var(--gold)">${p.email}</a>` : '‚Äî'}</span></div>
      </div>
      ${(p.features||[]).length > 0 ? `
        <div style="margin-top:12px;">
          <label style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;color:var(--text-light);">Deliverables</label>
          <div class="feature-tags">${p.features.map(f => {
            const name = typeof f === 'object' ? f.name : f;
            const timing = typeof f === 'object' && f.timing ? f.timing : '';
            return `<span class="badge badge-navy">${name}${timing ? `<span style="font-weight:400;opacity:0.75;"> ¬∑ ${timing}</span>` : ''}</span>`;
          }).join('')}</div>
        </div>` : ''}`;
  }
  div.classList.toggle('open');
}

// ‚îÄ‚îÄ Goal input formatter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtGoalInput(el) {
  const pos = el.selectionStart;
  const before = el.value.length;
  const raw = el.value.replace(/[^0-9]/g, '');
  el.value = raw ? parseInt(raw).toLocaleString() : '';
  // Restore cursor roughly (shift by inserted commas)
  const diff = el.value.length - before;
  el.setSelectionRange(pos + diff, pos + diff);
}

// ‚îÄ‚îÄ Scenario Planner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PKG_DEFAULTS = {
  'Tier 1':             { price: 4000,  color: OLIVE  },
  'Tier 2':             { price: 8000,  color: INDIGO },
  'Brand Spotlight':    { price: 10000, color: BLACK  },
  'New Opening':        { price: 6000,  color: STONE  },
  'Marketing Complete': { price: 4000,  color: DSHELL },
};

function initPlanner(D) {
  // Build pricing table from actual averages
  const tbody = document.getElementById('pkgPricingTable');
  Object.entries(PKG_DEFAULTS).forEach(([pkg, def]) => {
    const count = (D.countByStage || {})[pkg] || 0;
    const rev   = (D.byStage || {})[pkg] || 0;
    const avg   = def.price;
    tbody.innerHTML += `
      <tr>
        <td><span class="badge" style="background:${def.color}22;color:${def.color};border:1px solid ${def.color}55;">${pkg}</span></td>
        <td><input type="number" class="pkg-price-input" id="price-${pkg.replace(/ /g,'_')}" value="${avg}" step="500" oninput="updatePlanner()"></td>
        <td style="font-weight:700;">${count}</td>
        <td class="amount">${rev ? fmt(rev) : '‚Äî'}</td>
      </tr>`;
  });
  updatePlanner();
}

function getPkgPrice(pkg) {
  const el = document.getElementById('price-' + pkg.replace(/ /g, '_'));
  return el ? parseInt(el.value) || PKG_DEFAULTS[pkg]?.price || 0 : 0;
}

function updatePlanner() {
  if (typeof AMPLIFY_DATA === 'undefined') return;
  const D    = AMPLIFY_DATA;
  const goal = parseInt((document.getElementById('goalInput').value || '').replace(/[^0-9]/g, '')) || 1500000;
  const signed = D.totalSigned;
  const gap    = Math.max(0, goal - signed);
  const pctVal = Math.min(100, Math.round(signed / goal * 100));

  document.getElementById('plannerPct').textContent        = pctVal + '%';
  document.getElementById('plannerProgressBar').style.width = pctVal + '%';
  document.getElementById('plannerSignedLabel').textContent = fmt(signed) + ' signed';
  document.getElementById('plannerGoalLabel').textContent   = fmt(goal) + ' goal';
  document.getElementById('plannerGap').textContent         = gap > 0 ? fmt(gap) : '‚úì Goal reached!';
  document.getElementById('plannerGap').style.color         = gap > 0 ? RED : GREEN;
  document.getElementById('plannerPipelineAvail').textContent = fmt(D.inDiscussion + D.finalFollowUp);

  // Scenarios
  const t1Price  = getPkgPrice('Tier 1');
  const t2Price  = getPkgPrice('Tier 2');
  const bsPrice  = getPkgPrice('Brand Spotlight');
  const noPrice  = getPkgPrice('New Opening');

  const scenarios = [];
  if (gap <= 0) {
    scenarios.push({ title: 'üéâ Goal already reached!', rows: [{ pkg: 'Total signed', qty: fmt(signed) + ' / ' + fmt(goal) }] });
  } else {
    // Scenario A: Tier 1 only
    scenarios.push({
      title: 'Scenario A ‚Äî Close with Tier 1 only',
      rows: [{ pkg: 'Tier 1 packages needed', qty: Math.ceil(gap / t1Price) + ' more @ ' + fmt(t1Price) }]
    });
    // Scenario B: Balanced (same current ratio, excluding Marketing Complete)
    const totalCnt = (D.countByStage['Tier 1']||0) + (D.countByStage['Tier 2']||0) +
                     (D.countByStage['Brand Spotlight']||0) + (D.countByStage['New Opening']||0);
    if (totalCnt > 0) {
      const r1 = (D.countByStage['Tier 1']||0) / totalCnt;
      const r2 = (D.countByStage['Tier 2']||0) / totalCnt;
      const rBS = (D.countByStage['Brand Spotlight']||0) / totalCnt;
      const rNO = (D.countByStage['New Opening']||0) / totalCnt;
      const avgPriceBalanced = r1*t1Price + r2*t2Price + rBS*bsPrice + rNO*noPrice;
      const totalNew = Math.ceil(gap / avgPriceBalanced);
      scenarios.push({
        title: 'Scenario B ‚Äî Same mix as current',
        rows: [
          { pkg: 'Tier 1', qty: Math.ceil(totalNew * r1) + ' more' },
          { pkg: 'Brand Spotlight', qty: Math.ceil(totalNew * rBS) + ' more' },
          { pkg: 'Tier 2', qty: Math.ceil(totalNew * r2) + ' more' },
          { pkg: 'New Opening', qty: Math.ceil(totalNew * rNO) + ' more' },
          { pkg: 'Total new partners', qty: '~' + totalNew },
        ]
      });
    }
    // Scenario C: Premium focus (50% BS, 30% T2, 20% T1)
    const avgPricePremium = 0.5*bsPrice + 0.3*t2Price + 0.2*t1Price;
    const premiumTotal = Math.ceil(gap / avgPricePremium);
    scenarios.push({
      title: 'Scenario C ‚Äî Premium focus (more Brand Spotlight & Tier 2)',
      rows: [
        { pkg: 'Brand Spotlight (50%)', qty: Math.ceil(premiumTotal * 0.5) + ' more @ ' + fmt(bsPrice) },
        { pkg: 'Tier 2 (30%)', qty: Math.ceil(premiumTotal * 0.3) + ' more @ ' + fmt(t2Price) },
        { pkg: 'Tier 1 (20%)', qty: Math.ceil(premiumTotal * 0.2) + ' more @ ' + fmt(t1Price) },
        { pkg: 'Total new partners', qty: '~' + premiumTotal },
      ]
    });
  }

  const sl = document.getElementById('scenarioList');
  sl.innerHTML = '';
  scenarios.forEach(s => {
    sl.innerHTML += `
      <div class="scenario-card">
        <h4>${s.title}</h4>
        <div class="scenario-rows">
          ${s.rows.map(r => `<div class="scenario-row"><span class="pkg">${r.pkg}</span><span class="qty">${r.qty}</span></div>`).join('')}
        </div>
      </div>`;
  });

  // Fill rate table
  const fillTarget = goal;
  const fillEl = document.getElementById('fillRateTable');
  fillEl.innerHTML = `
    <table class="pkg-table">
      <thead><tr><th>Package</th><th>Signed</th><th>Revenue</th><th>% of total signed</th><th>Progress to goal contribution</th></tr></thead>
      <tbody>
        ${Object.entries(PKG_DEFAULTS).map(([pkg]) => {
          const count = (AMPLIFY_DATA.countByStage || {})[pkg] || 0;
          const rev   = (AMPLIFY_DATA.byStage || {})[pkg] || 0;
          const revPct = AMPLIFY_DATA.totalSigned > 0 ? Math.round(rev / AMPLIFY_DATA.totalSigned * 100) : 0;
          const goalPct = Math.min(100, Math.round(rev / goal * 100));
          return `
            <tr>
              <td>${stageBadge(pkg)}</td>
              <td style="font-weight:700;">${count}</td>
              <td class="amount">${fmt(rev)}</td>
              <td>${revPct}%</td>
              <td>
                <div style="font-size:12px;color:var(--text-light);margin-bottom:3px;">${goalPct}% of goal</div>
                <div class="mini-progress"><div class="mini-progress-fill" style="width:${goalPct}%"></div></div>
              </td>
            </tr>`;
        }).join('')}
      </tbody>
    </table>`;
}

// ‚îÄ‚îÄ Next Steps ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildNextSteps(D) {
  const steps = [
    {
      title: `Invoice ${fmt(D.needsInvoice)} in signed partners`,
      body: `${D.needsInvoiceCount} signed partner${D.needsInvoiceCount !== 1 ? 's' : ''} with contracts but no invoice yet. Get these out this week to start the payment clock.`,
      tag: 'urgent'
    },
    {
      title: `Follow up on ${fmt(D.outstanding)} in outstanding invoices`,
      body: `Invoices sent but not yet paid. Prioritize higher-value Tier 2 and Brand Spotlight partners. Anyone 30+ days past invoice date should get a friendly payment reminder.`,
      tag: 'urgent'
    },
    ...(D.waitingBilling > 0 ? [{
      title: `Collect billing details (${fmt(D.waitingBilling)})`,
      body: `Revenue is stuck in "Waiting for billing details" status. A quick email nudge can unblock these invoices.`,
      tag: 'this-week'
    }] : []),
    {
      title: `Convert ${D.inDiscussionCount} In-Discussion partners`,
      body: `${fmt(D.inDiscussion)} in potential revenue is scoped. Prioritize those with quotes already sent and focus on closing before Q1 deliverables begin.`,
      tag: 'this-week'
    },
    ...((D.quarters?.TBD || 0) > 0 ? [{
      title: `Assign deliverable quarters for ${D.quarters.TBD} partners`,
      body: `${D.quarters.TBD} signed partners don't have a quarter preference recorded. Critical for scheduling content in Q1 and Q2.`,
      tag: 'this-week'
    }] : []),
    {
      title: `Review Final Follow Up stage (${D.finalFollowUpCount} partners)`,
      body: `${D.finalFollowUpCount} partners in Final Follow Up. These are your last chances to convert before they go cold.`,
      tag: 'this-week'
    },
    {
      title: 'Plan Q1 content delivery calendar',
      body: `${D.quarters?.Q1 || 0} partners want Q1 deliverables, ${D.quarters?.Q2 || 0} want Q2. Confirm scheduling with the content team now to avoid a crunch.`,
      tag: 'ongoing'
    },
  ];

  const grid = document.getElementById('nextStepsGrid');
  const tagLabels = { urgent: 'Urgent', 'this-week': 'This week', ongoing: 'Ongoing', nice: 'Quick win' };
  steps.forEach((s, i) => {
    grid.innerHTML += `
      <div class="next-step-card">
        <div class="step-number">${i+1}</div>
        <div class="step-content">
          <h4>${s.title}</h4>
          <p>${s.body}</p>
          <span class="step-tag ${s.tag}">${tagLabels[s.tag]}</span>
        </div>
      </div>`;
  });
}

// ‚îÄ‚îÄ Team Updates ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildTeamUpdates(D) {
  const paidPct = D.totalSigned > 0 ? Math.round(D.paid / D.totalSigned * 100) : 0;
  const updates = [
    { dot: 'gold',  text: `<strong>${D.signedCount} partners signed</strong> for Amplify 2026 ‚Äî Tier 1 leads with ${D.countByStage?.['Tier 1'] || 0} properties. Strong growth across top hotel groups.` },
    { dot: 'green', text: `<strong>${fmt(D.paid)} collected</strong> ‚Äî ${paidPct}% of total signed value paid.` },
    { dot: 'amber', text: `<strong>${fmt(D.outstanding)} outstanding</strong> in sent invoices awaiting payment. Following up is the highest-value action this week.` },
    { dot: 'navy',  text: `<strong>${D.inDiscussionCount} partners in active discussion</strong> ‚Äî ${fmt(D.inDiscussion)} in additional revenue potential.` },
    ...(D.waitingBilling > 0 ? [{ dot: 'amber', text: `<strong>${fmt(D.waitingBilling)} waiting on billing details</strong> ‚Äî quick follow-ups needed to unblock invoicing.` }] : []),
  ];

  const ul = document.getElementById('updateList');
  updates.forEach(u => {
    ul.innerHTML += `
      <div class="update-item">
        <div class="update-dot ${u.dot}"></div>
        <div class="update-text">${u.text}</div>
      </div>`;
  });

  // Snapshot
  const snapshot = buildSnapshot(D);
  document.getElementById('copySnapshot').textContent = snapshot;
}

function buildSnapshot(D) {
  const paidPct = D.totalSigned > 0 ? Math.round(D.paid/D.totalSigned*100) : 0;
  const byStage = Object.entries(D.byStage || {}).map(([k,v]) => `  ‚Ä¢ ${k}: ${fmt(v)} (${D.countByStage?.[k] || 0})`).join('\n');
  const topGroups = (D.topGroups || []).slice(0,3).map(([l,c]) => `${l} (${c})`).join(', ');
  const topCountries = (D.topCountries || []).slice(0,3).map(([l,c]) => `${l} (${c})`).join(', ');
  return `FORA AMPLIFY 2026 ‚Äî WEEKLY SNAPSHOT
${D.lastUpdated}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
SIGNED PARTNERS: ${D.signedCount}
${byStage}

SIGNED VALUE: ${fmt(D.totalSigned)}  |  TOTAL PIPELINE: ${fmt(D.totalPipeline)}

INVOICE STATUS:
  ‚Ä¢ Paid:            ${fmt(D.paid)} (${paidPct}%)
  ‚Ä¢ Outstanding:     ${fmt(D.outstanding)}
  ‚Ä¢ Waiting Billing: ${fmt(D.waitingBilling)}
  ‚Ä¢ Needs Invoice:   ${fmt(D.needsInvoice)} (${D.needsInvoiceCount} partners)

PIPELINE:
  ‚Ä¢ In Discussion:   ${fmt(D.inDiscussion)} (${D.inDiscussionCount} partners)
  ‚Ä¢ Final Follow Up: ${fmt(D.finalFollowUp)} (${D.finalFollowUpCount} partners)

DELIVERABLES: Q1: ${D.quarters?.Q1||0}  |  Q2: ${D.quarters?.Q2||0}  |  Q3: ${D.quarters?.Q3||0}  |  TBD: ${D.quarters?.TBD||0}

TOP GROUPS: ${topGroups}
TOP COUNTRIES: ${topCountries}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;
}

function copySnapshot() {
  const notes = document.getElementById('weeklyNotes').value;
  const base  = buildSnapshot(AMPLIFY_DATA);
  const full  = base + (notes ? '\n\nTEAM NOTES:\n' + notes : '');
  navigator.clipboard.writeText(full).then(() => {
    const btn = event.target;
    btn.textContent = 'Copied!';
    btn.style.background = '#3fa87a';
    setTimeout(() => { btn.textContent = 'Copy Summary'; btn.style.background = ''; }, 2000);
  });
}

// ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
init();
</script>
</body>
</html>
